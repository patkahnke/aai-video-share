
{% set container = theme.settings.fluid_container ? 'container-fluid' : 'container' %}
{# Navbar #}
{% if page.navigation or page.navigation_collapsible %}
    {% block navbar %}
        {%
        set navbar_classes = [
        'navbar',
        theme.settings.navbar_inverse ? 'navbar-inverse' : 'navbar-default',
        theme.settings.navbar_position ? 'navbar-' ~ theme.settings.navbar_position|clean_class : container,
        ]
        %}

        <header{{ navbar_attributes.addClass(navbar_classes) }} id="navbar" role="banner">
            <div class="navbar-header">
                {{ page.navigation }}
                {# .btn-navbar is used as the toggle for collapsed navbar content #}
                {% if page.navigation_collapsible %}
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">{{ 'Toggle navigation'|t }}</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                {% endif %}
            </div>

            {# Navigation (collapsible) #}
            {% if page.navigation_collapsible %}
                <div class="navbar-collapse collapse">
                    {{ page.navigation_collapsible }}
                </div>
            {% endif %}
        </header>
    {% endblock %}
{% endif %}

{# Main #}
{% block main %}
    <div role="main" class="main-container {{ container }} js-quickedit-main-content">
        <div class="row">

             {# Header #}
            {% if page.header %}
                {% block header %}
                    <div class="col-sm-12" role="heading">
                        {{ page.header }}
                    </div>
                {% endblock %}
            {% endif %}

             {# Sidebar First #}
            {% if page.sidebar_first %}
                {% block sidebar_first %}
                    <aside class="col-sm-3" role="complementary">
                        {{ page.sidebar_first }}
                    </aside>
                {% endblock %}
            {% endif %}

            {# Content #}

            <div class="row, col-sm-8">
                <a href="http://aai_challenge.dd:8083/new_video_form" class="use-ajax" data-accepts="application/vnd.drupal-modal">Add a Video!</a><br>
            </div><br>


            {#<div class="new-video-form, row, col-sm-12">#}
                {#<a href="{{ proof_api.new_video}}"  class="use-ajax">Add a Video!</a><br>#}
                {#<a href="http://aai_challenge.dd:8083/all_videos">All Videos</a><br>#}
                {#<a href="http://aai_challenge.dd:8083/top_ten_by_views">Most Viewed Videos</a><br>#}
                {#<a href="http://aai_challenge.dd:8083/top_ten_by_votes">Highest Voted Videos</a><br>#}
                {#<div class="col-md-12"><span>- - -</span></div>#}
            {#</div><br>#}

           {% for video in videos %}
               {#<div id="movies" class="row">#}
               {#</div>#}
               {#<div class="col-sm-8">{{ link(video.attributes.title, 'http://aai-video-share.dd:8083/view_video/' ~ video.id ) }}</div>#}

               <div class="container, col-sm-12">
                <div class="col-sm-12">
                   <span class="video-labels">Views: {{ video.attributes.view_tally }}</span>
                   <span class="video-labels">Votes: {{ video.attributes.vote_tally }}</span>
                   <span class="video-labels">{{ link('+1', 'http://aai-video-share.dd:8083/vote_up/' ~ video.id ~ '/' ~ redirectTo ) }}</span>
                   <span class="video-labels">{{ link('-1', 'http://aai-video-share.dd:8083/vote_down/' ~ video.id ~ '/' ~ redirectTo ) }}</span>
                </div>
               <div class="col-sm-12" align="center">
                   <iframe id="proof-api-videos"
                           width="640" height="480"
                           src="https://{{ video.attributes.embedURL }}"
                           frameborder="0"
                           style="border: solid 4px #37474F"
                   ></iframe>
               </div>
                   <div class="col-md-12"><span>- - -</span></div>
               </div>

            <script type="text/javascript">
                var tag = document.createElement('script');

                tag.src = 'https://www.youtube.com/iframe_api';
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                var player;
                function onYouTubeIframeAPIReady() {
                    player = new YT.Player('player', {
                        events: {
                            'onStateChange': onPlayerStateChange
                        }
                    });
                    console.log("onYouTube etc function is working");
                }

                var done = false;
                function onPlayerStateChange(event) {
                    if (event.data == 1 && !done) {
                        setTimeout(stopVideo, 6000);
                        done = true;
                        console.log("onPlayerStateChange is firing")
                    }
                }

                function stopVideo() {
                    player.stopVideo();
                }

{#//                var voted = false;#}
                {#function onPlayerStateChange() {#}
                        {#document.getElementById('http://aai-video-share.dd:8083/new_view/'{{ video.id }}).click();#}
                        {#document.getElementById('proof-api-videos').style.borderColor = '#DD2C00';#}
{#//                        voted = true;#}
                {#}#}

         </script>
           {% endfor %}

        <div class="row">
            <div class="movie-list, container, col-sm-6">
                <div class="row">
                    <ul>
                        {% for video in videos %}


                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

            {%
            set content_classes = [
            page.sidebar_first and page.sidebar_second ? 'col-sm-6',
            page.sidebar_first and page.sidebar_second is empty ? 'col-sm-9',
            page.sidebar_second and page.sidebar_first is empty ? 'col-sm-9',
            page.sidebar_first is empty and page.sidebar_second is empty ? 'col-sm-12'
            ]
            %}
            <section{{ content_attributes.addClass(content_classes) }}>

                {# Highlighted #}
                {% if page.highlighted %}
                    {% block highlighted %}
                        <div class="highlighted">{{ page.highlighted }}</div>
                    {% endblock %}
                {% endif %}

                {# Breadcrumbs #}
                {% if breadcrumb %}
                    {% block breadcrumb %}
                        {{ breadcrumb }}
                    {% endblock %}
                {% endif %}

                {# Action Links #}
                {% if action_links %}
                    {% block action_links %}
                        <ul class="action-links">{{ action_links }}</ul>
                    {% endblock %}
                {% endif %}

                {# Help #}
                {% if page.help %}
                    {% block help %}
                        {{ page.help }}
                    {% endblock %}
                {% endif %}

                {# Content #}
                {% block content %}
                    <a id="main-content"></a>
                    {{ page.content }}
                {% endblock %}
            </section>

            {# Sidebar Second #}
            {% if page.sidebar_second %}
                {% block sidebar_second %}
                    <aside class="col-sm-3" role="complementary">
                        {{ page.sidebar_second }}
                    </aside>
                {% endblock %}
            {% endif %}
        </div>
    </div>
{% endblock %}

{% if page.footer %}
    {% block footer %}
        <footer class="footer {{ container }}" role="contentinfo">
            {{ page.footer }}
        </footer>
    {% endblock %}
{% endif %}